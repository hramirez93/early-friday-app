<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Early Friday Area | Live App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body class="bg-[#0f172a] text-slate-200 min-h-screen">

    <nav class="p-5 glass sticky top-0 z-50 flex justify-between items-center px-8 border-b border-slate-800">
        <div class="flex items-center gap-2">
            <span class="text-2xl">üöÄ</span>
            <h1 class="text-xl font-bold tracking-tight text-white">Early<span class="text-blue-500">Friday</span></h1>
        </div>
        <div id="status-dot" class="flex items-center gap-2 text-[10px] uppercase tracking-widest font-bold">
            <span id="dot" class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
            <span id="status-text" class="text-slate-400">Desconectado</span>
        </div>
    </nav>

<main class="max-w-5xl mx-auto p-6 space-y-6">
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="glass p-4 rounded-2xl border-l-4 border-blue-500">
            <p class="text-xs text-slate-400 uppercase font-bold">Total Solicitudes</p>
            <p id="stat-total" class="text-2xl font-bold text-white">0</p>
        </div>
        <div class="glass p-4 rounded-2xl border-l-4 border-emerald-500">
            <p class="text-xs text-slate-400 uppercase font-bold">Aprobadas</p>
            <p id="stat-aprobadas" class="text-2xl font-bold text-emerald-400">0</p>
        </div>
        <div class="glass p-4 rounded-2xl border-l-4 border-amber-500">
            <p class="text-xs text-slate-400 uppercase font-bold">Pendientes</p>
            <p id="stat-pendientes" class="text-2xl font-bold text-amber-400">0</p>
        </div>
    </div>

    <section class="glass rounded-3xl p-6 shadow-2xl">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label class="block text-[10px] uppercase font-bold text-slate-500 mb-1 ml-1">Mi Nombre</label>
                <input id="userName" type="text" placeholder="Tu nombre" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2 text-white outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-[10px] uppercase font-bold text-slate-500 mb-1 ml-1">Mi Equipo</label>
                <select id="userTeam" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2 text-white outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="Hugo">Equipo Hugo</option>
                    <option value="Elena">Equipo Elena</option>
                    <option value="Carol">Equipo Carol</option>
                    <option value="Malu">Equipo Mal√∫ / Annie</option>
                </select>
            </div>
            <div>
                <label class="block text-[10px] uppercase font-bold text-slate-500 mb-1 ml-1">Tarea Finalizada</label>
                <input id="userTask" type="text" placeholder="¬øQu√© terminaste?" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2 text-white outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="flex items-end">
                <button onclick="sendToCloud()" id="btn-send" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 rounded-xl transition-all shadow-lg active:scale-95">
                    Registrar Salida
                </button>
            </div>
        </div>
    </section>

    <section class="glass rounded-3xl overflow-hidden shadow-xl border border-slate-800">
        <div class="overflow-x-auto">
            <table class="w-full text-left">
                <thead class="bg-slate-900/50 text-[10px] uppercase text-slate-500 font-bold">
                    <tr>
                        <th class="p-4">Miembro / Equipo</th>
                        <th class="p-4">Actividad</th>
                        <th class="p-4 text-center">Estado</th>
                        <th class="p-4 text-right">Hora</th>
                    </tr>
                </thead>
                <tbody id="live-list" class="divide-y divide-slate-800"></tbody>
            </table>
        </div>
    </section>
</main>

    <script>
        // --- CONFIGURACI√ìN DE SUPABASE ---
        const SB_URL = "https://sexnefbexmhxnakihcov.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNleG5lZmJleG1oeG5ha2loY292Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyNTM3MjMsImV4cCI6MjA4MzgyOTcyM30.QSpCGC-1-XzHil1YK15y0MntkPgC0WMzh_i4J-eiJ0I"; // REEMPLAZA ESTO
        // ---------------------------------

        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        // Funci√≥n para cargar datos
        // Actualiza tu funci√≥n sendToCloud para incluir el equipo
async function sendToCloud() {
    let name = document.getElementById('userName').value.trim();
    let task = document.getElementById('userTask').value.trim();
    let equipo = document.getElementById('userTeam').value;
    const btn = document.getElementById('btn-send');

    if(!name || !task) return alert("Por favor completa todos los campos");

    btn.disabled = true;
    btn.innerText = "üöÄ Enviando...";

    try {
        const { error } = await _supabase
            .from('registros')
            .insert([{ 
                name: name, 
                task: task, 
                equipo: equipo, 
                estado: 'pendiente' // El valor que definimos
            }]);

        if (error) throw error;
        
        document.getElementById('userTask').value = "";
        await loadData(); 
    } catch (err) {
        alert("Error: " + err.message);
    } finally {
        btn.disabled = false;
        btn.innerText = "Registrar Salida";
    }
}

// Actualiza la funci√≥n render para mostrar los estados y equipos
function render(items) {
    const list = document.getElementById('live-list');
    
    // Actualizar Indicadores
    document.getElementById('stat-total').innerText = items.length;
    document.getElementById('stat-aprobadas').innerText = items.filter(i => i.estado === 'aprobado').length;
    document.getElementById('stat-pendientes').innerText = items.filter(i => i.estado === 'pendiente').length;

    if (items.length === 0) {
        list.innerHTML = '<tr><td colspan="4" class="p-10 text-center text-slate-600 italic">No hay registros hoy.</td></tr>';
        return;
    }

    list.innerHTML = items.map(i => {
        let statusClass = "bg-amber-500/10 text-amber-500 border-amber-500/20";
        if(i.estado === 'aprobado') statusClass = "bg-emerald-500/10 text-emerald-500 border-emerald-500/20";
        
        return `
            <tr class="hover:bg-slate-700/20">
                <td class="p-4">
                    <div class="font-bold text-white">${i.name}</div>
                    <div class="text-[10px] text-blue-400 uppercase font-bold">Equipo ${i.equipo}</div>
                </td>
                <td class="p-4 text-slate-300 text-sm">${i.task}</td>
                <td class="p-4 text-center">
                    <span class="px-3 py-1 rounded-full border text-[10px] font-bold ${statusClass}">
                        ${i.estado.toUpperCase()}
                    </span>
                </td>
                <td class="p-4 text-right text-[10px] font-mono text-slate-500">
                    ${new Date(i.created_at).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}
                </td>
            </tr>
        `;
    }).join('');
}

        // L√≥gica del mensaje de bienvenida seg√∫n el d√≠a
        function updateHeader() {
            const now = new Date();
            const day = now.getDay();
            const msgEl = document.getElementById('friday-msg');
            
            if (day === 5) {
                msgEl.innerText = "¬°Lleg√≥ el Viernes! ‚ú®";
                msgEl.className = "text-3xl font-bold text-emerald-400 mb-2";
            } else if (day === 4) {
                msgEl.innerText = "Ma√±ana es Early Friday... ‚è≥";
            } else {
                msgEl.innerText = "Preparando el Early Friday üë®‚Äçüíª";
            }
        }

        // Inicializaci√≥n
        updateHeader();
        loadData();
        
        // Auto-refresco cada 10 segundos
        setInterval(loadData, 10000);
    </script>
</body>
</html>